<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">

		<title>Xytabich</title>

		<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto">
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
		<link rel="stylesheet" href="/style.css">
		<link rel="stylesheet" href="/indexstyle.css">

		<script type="text/javascript">
			var onPagelistLoaded, onElementsLoaded, getPagePath;
			{
				var pages = null, isHeaderLoaded = false, pagePath, pathToPage = {};
				onPagelistLoaded = function(list)
				{
					pages = list;
					if(isHeaderLoaded) initPages();
				}
				onElementsLoaded = function()
				{
					isHeaderLoaded = true;
					if(pages != null) initPages();
				}
				function initPages()
				{
					var header = document.body.querySelector("body > header");
					var p = new URL(window.location).searchParams.get("p");
					p = p == null ? "" : p.trim();
					if(p.startsWith("/")) p = p.substring(1);
					if(p && p == "") p = "main.html";
					buildMenuButton(pages, null, function(element) { header.appendChild(element); }, p);
					pagePath = pathToPage[p] ? p : "main.html";

					var title = "";
					var page = pathToPage[pagePath];
					while(page != null) {
						title = " > " + page.name + title;
						page = page.parent;
					}
					document.title = "Xytabich" + title;
					document.getElementById("page-container").data = new URL(pagePath, window.location).toString();
				}
				function buildMenuButton(pages, parent, appendChild, currentPath)
				{
					for(var k in pages) {
						var page = pages[k];
						pathToPage[k] = page;
						if(parent != null) page.parent = parent;

						if(page.hide) appendChild = null;
						if(appendChild == null) {
							buildMenuButton(page.pages, page, null, currentPath);
						}
						else {
							var element = document.createElement("a");
							element.className = "item-link";
							if(k == currentPath) {
								element.classList.toggle("active", true);
							}
							if(!page.noLink) element.href = "/index.html?p=" + encodeURIComponent(k);
							element.innerHTML = page.name;
							page.element = element;

							if(page.pages) {
								var root = document.createElement("div");
								root.className = "list-root";
								root.appendChild(element);

								var ul = document.createElement("ul");
								buildMenuButton(page.pages, page, function(element)
								{
									var li = document.createElement("li");
									li.appendChild(element);
									ul.appendChild(li);
								}, currentPath);
								root.appendChild(ul);

								element = root;
							}
							appendChild(element);
						}
					}
				}
				getPagePath = function()
				{
					return pagePath;
				}
			}
			function loadDynamicScript(path)
			{
				var script = document.head.appendChild(document.createElement("script"));
				script.type = "text/javascript";
				script.src = path + "?v=" + Date.now();
			}
			loadDynamicScript("/pagelist.js");
		</script>
	</head>
	<body>
		<header class="list"></header>
		<content><object type="text/html" id="page-container"></object></content>
		<script type="text/javascript">onElementsLoaded();</script>
	</body>
</html>